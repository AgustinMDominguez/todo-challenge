> Spanish README.md here -> [README_ES.md](README_ES.md)

# Invera ToDo-List Challenge
> Technical interview challenge for a SSr Python/Django position

> **Author:** Agustín Marcelo Domínguez: `agustinmarcelodominguez@gmail.com`

> **Date** August 2021

# Table of contents

- [Invera ToDo-List Challenge](#invera-todo-list-challenge)
- [Table of contents](#table-of-contents)
- [Challenge](#challenge)
  - [Intro](#intro)
  - [What we want you to do](#what-we-want-you-to-do)
  - [Objetives](#objetives)
  - [What we will value in the product](#what-we-will-value-in-the-product)
  - [Devivery Requirements](#devivery-requirements)
- [Delivery and Product](#delivery-and-product)
  - [Run Locally](#run-locally)
    - [Direct Run](#direct-run)
    - [Docker](#docker)
    - [Postman](#postman)
  - [Endpoints](#endpoints)
    - [General Description](#general-description)
    - [search-tasks](#search-tasks)
  - [Style and architecture](#style-and-architecture)
  - [References](#references)
  - [Known bugs / potential improvements](#known-bugs--potential-improvements)

# Challenge

## Intro

The purpose of this test is to get to know your ability to create a small functional application with a deadline. Below you'll find the functions, the requirements, and key points to have in mind during development.

## What we want you to do

- This challenge consists of creating a simple web application that allows users to create and hold a list of ToDos.
- The delivery of the product must be a new fork of this repository and you'll need to do a small demo of the functionality and development of the proyect before a super committee of the greatest minds at Invera, or some devs, whatever is easier to get.
- You can contact us if you have questions.

## Objetives

The user of the aplication must be capable of:

- Create a task
- Delete a task
- Set tasks as "Done"
- Get a list of the current existing tasks
- Filter/search tasks by date of creation and content

## What we will value in the product 

- Development using Python, and Django. Development of the Front-End side is not necessary, but it is necessary the the backend API that can fufill the objectives.
- Architecture and code quality. Code readability and ease of maintenance.
- **[Bonus]** Log management.
- **[Bonus]** Implementation of Tests (Integration Tests and Unit Tests)
- **[Bonus]** Delivery of solution in a Docker Image.

## Devivery Requirements

- Fork the proyect and push it to GitHub. It can private.
- Solution must run correctly.
- README must contain instructions on how to properly setup and run the solution.
- Availability to perform a little demo of the proyect upon completion.
- Delivery time: 7 days.
  

# Delivery and Product
## Run Locally

### Direct Run

Create a virtual enviroment and install requirements:

```bash
python3 -m venv venv_invera_todo
source venv_invera_todo/bin/activate
pip install --upgrade pip
pip install -r requirements.txt
```

Run Server

```bash
python manage.py runserver
```

### Docker
Run:

```bash
docker-compose build && docker-compose up
```

Then requests can be made to `http://127.0.0.1:8000` (see [Postman](#postman) section)

### Postman

A [Postman](https://www.postman.com/) collection is provided, (file is called `postman_collection.json`) with examples of endpoints to run directly.

To import the collection, in Postman go to `import` -> `file` and select collection file `postman_collection.json`.

Have in mind that the underlying database was not uploaded, so on the first run you must register, login, and update the `PROFILE_TOKEN` enviroment variable of the Postman collection.

Once the `login` endpoint is hit and the token is returned, double click on the collection, go to `variables`and update both `INITIAL VALUE` and `CURRENT VALUE` with the token returned. Then hit the `logged_in` endpoint and it should return with 200, with user information and current profile.

## Endpoints

**All endpoints that ask for a body ask it in JSON format**

**The parameters of *POST* endpoints are parsed in like JavaScript types (ie. null, true, ...)**

**on the other hand, the query parameters of *GET* endpoints are parsed as Python types (ie. None, True, ['apple'])**
**with the exception of `start_time` y `end_time` which are on isoformat generated by js**

**mientras que cuando los endpoints son *GET* los tipos son parseados como en Python (ie. None, True, ['apple'])**
**con la excepcion de `start_time` y `end_time` que pueden ser isoformat generado por js**

**If a profile is created or updated, the token asociated is updated; so further calls to the API must be made with the new token, token which is always provided from the login endpoint**

### General Description

| Type | Endpoint                            | Params/Body                                                             | Return                                                                                    |
|------|-------------------------------------|-------------------------------------------------------------------------|-------------------------------------------------------------------------------------------|
| GET  | `/todo/up`                          | `None`                                                                  | `{"status": "ok"}`                                                                        |
| POST | `/todo/register`                    | `{"username": str, "email": str, "password": str}`                      | `{"status": "ok"}`                                                                        |
| POST | `/todo/login`                       | `{"username": str, "password": str}`                                    | `{"profiles": [{"name": str, "token": "ey..."}]}` Lists of profiles with their respective auth tokens |
| GET  | `/todo/logged_in`                   | `None`                                                                  | `{"user": str, "profile": str}` if the token is accepted                                  |
| POST | `/todo/create-profile`              | `{"name": str}`                                                         | `{"status": "ok", "result": {"name": str, "token": token}}`                               |
| POST | `/todo/rename-profile`              | `{"old_profile_name": str, "new_profile_name": str}`                    | `{"status": "ok", "result": {"name": str, "user": str, "token": token}}`                  |
| POST | `/todo/delete-profile`              | `{"profile_name": str}`                                                 | `{"status": "ok", "result": {"deleted": true}}`                                           |
| POST | `/todo/add-task`                    | OBLIGATORY: `title` - OPTIONAL: `parent_id: int, description: str, done: bool, tags: list[str], favorite: bool,` | `{"status": "ok", "result": {"id": int, "parent_id": int, "title": str, "description": str, "done": bool, "favorite": bool, "created_at": datetime}}` |
| GET  | `/todo/search-tasks`                | See [search-tasks](#search-tasks) | `{"status": "ok", "result": {"amount": int, "tasks": [task...]}}`                         |
| POST | `/todo/task/<int:task_id>/done`     | `{"done": bool}`                                                        | `{"status": "ok", "result": {"id": int, "parent_id": int, "title": str, "description": str, "done": bool, "favorite": bool, "created_at": datetime}}` |
| POST | `/todo/task/<int:task_id>/update`   | Can be optionally updated: `title: str, parent_id: int, description: str, done: bool, tags: list[str], favorite: bool` | `{"status": "ok", "result": {"id": int, "parent_id": int, "title": str, "description": str, "done": bool, "favorite": bool, "created_at": datetime}}` |
| POST | `/todo/task/<int:task_id>/delete`   | `None`                         | `{"status": "ok", "result": {"deleted": true}}`                                           |
| GET  | `/todo/task/<int:task_id>/children` | Same fields as `search-tasks` but limited to subtasks of if `task_id`  | `{"status": "ok", "result": {"tasks": [task...]}}`                  |


### search-tasks

Since it is a `GET Request`, filter arguments are passed as query parameters, ie:

`/todo/search-tasks?search_sub_tree=True&done=False&parent_id=9&tags=["apple", "some"]`

The parameters (all optional) passed can be:

 * `done : str` - Filter done and uncompleted tasks
 * `title : str` - Must be an exact match
 * `parent_id : int` - Limits search to subtask of this parent task. (same behavior can be achieved with `/todo/task/<int:task_id>/children`)
 * `tags : list[str]` - A non exlucive OR filter for tags.
 * `favorite : bool` - Filter tasks marked as favorite.
 * `start_time : datetime` - Parsed with isoformat `iso8601`, filter tasks created after date.
 * `end_time : datetime` - SParsed with isoformat `iso8601`, filter tasks created before date.
 * `page : int` - As default behavior, a pagination of 50 results exists on queries, so this parameters can be used to fetch further pages.
 * `search_sub_tree : bool` - Default value: false. If this value is false, the search will not include subtasks

## Style and architecture

The recommended architecture for Django proyects was followed, with PEP8 style complicance for Python, helped with the tool `pycodestyle`

```bash
pycodestyle . --exclude=venv_*,**migrations**
```

## References

 - [Use tokens for authentication in Django](https://www.django-rest-framework.org/api-guide/authentication/#setting-the-authentication-scheme)
 - [Django default auth](https://docs.djangoproject.com/en/3.2/topics/auth/default/)
 - [Expose vs publish Docker](https://www.baeldung.com/ops/docker/expose-vs-publish)
 - [Django Pagination](https://docs.djangoproject.com/en/3.2/topics/pagination/)
 - [django-taggit](https://django-taggit.readthedocs.io/en/latest/api.html)

## Known bugs / potential improvements

 - There's no prevention for circular subtasks
 - Search with title must be an exact match, when it could be more elastic.
   - Possible solution: Implements title as tags ignoring stop-wordsPosible solución: Incorporar como tags e ignorando stop-words
